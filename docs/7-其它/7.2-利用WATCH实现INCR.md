# 利用WATCH实现INCR
关于WATCH命令在[官方文档](https://redis.io/topics/transactions#optimistic-locking-using-check-and-set)中有这样一个例子（实现自增）：
```
WATCH mykey
val = GET mykey
val = val + 1
MULTI
SET mykey $val
EXEC
```
当尝试以Jedis来实现时：
```
public class RedisTest {
    @Test
    public void testMultiIncrFalse(){
        try (Jedis jedis = new Jedis("localhost", 6379)) {
            Pipeline pipelined = jedis.pipelined();
            // 监控mykey以防止被其它client修改
            pipelined.watch("mykey");
            Response<String> myKeyResp = pipelined.get("mykey");
            int myKey = Integer.parseInt(myKeyResp.get());
            // 开启事务
            pipelined.multi();
            // 执行增加1操作
            pipelined.set("mykey", String.valueOf(myKey + 1));
            pipelined.exec();
        }
    }
}
```
却得到了以下错误信息：
```
redis.clients.jedis.exceptions.JedisDataException: Please close pipeline or multi block before calling this method.
```
可能原因是在MULTI开启事务后，在EXEC时命令才会真正执行，因此在MULTI与EXEC之间是GET不到结果的。
（同时在Pipeline中也不能使用Jedis对象）

**那到底咋个实现？**